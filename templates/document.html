{% extends "base.html" %}

{% block title %}{{ doc.name or doc.file_name }}{% endblock %}

{% block content %}
  <a href="/" class="back-link">← Назад к списку</a>
  <h1 class="doc-title">{{ doc.file_name }} {% if doc.name %} — {{ doc.name }}{% endif %}</h1>
  <p class="doc-meta">Добавлено: {{ doc.created_at.strftime('%Y-%m-%d %H:%M') }}</p>

  <hr>

  <h2>Исходный текст</h2>
  <div class="original">
    {{ doc.original_text }}
  </div>

  <hr>

  <h2>Сводки</h2>

  {% set summaries = [
    ('llm_text', 'LLM (Текст)', doc.summary.llm_text_summary.ru, 'text'),
    ('llm_keyword', 'LLM (Ключевые слова)', doc.summary.llm_keyword_summary.ru, 'keyword'),
    ('extraction_text', 'Извлечение (Текст)', doc.summary.extraction_text_summary.ru, 'text'),
    ('extraction_keyword', 'Извлечение (Ключевые слова)', doc.summary.extraction_keyword_summary.ru, 'keyword'),
  ] %}

  {% for id, name, summary_data, type in summaries %}
  <div class="summary-block">
    <h3>{{ name }}</h3>
    <button type="button" class="toggle-btn" onclick="toggle('{{ id }}-content', this)">Показать</button> 
    
    <div id="{{ id }}-content" class="collapsible">
        {% if type == 'text' %}
            <p>{{ summary_data }}</p>
        {% elif type == 'keyword' %}
            {% macro render_keywords(node) %}
                <li>{{ node.keyword }}
                    {% if node.children %}
                        <ul class="kw-tree">
                            {% for child in node.children %}
                                {{ render_keywords(child) }}
                            {% endfor %}
                        </ul>
                    {% endif %}
                </li>
            {% endmacro %}
            <ul class="kw-tree">
                {{ render_keywords(summary_data) | safe }}
            </ul>
        {% endif %}
    </div>
  </div>
  {% endfor %}

{% endblock %}
